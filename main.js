(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/plus-cohort-3",headers:{authorization:"02385e69-13e7-4a45-9c9c-ba6d7f7e0793","Content-Type":"application/json"}};function t(){return fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}function n(e){e.classList.add("popup_opened"),document.addEventListener("keydown",r)}function o(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",r)}function r(e){"Escape"===e.key&&o(document.querySelector(".popup_opened"))}var c=document.querySelector(".image");function a(t,o,r){var a=document.querySelector(".elements-template").content.querySelector(".element").cloneNode(!0),u=a.querySelector(".element__image"),i=a.querySelector(".element__like"),l=a.querySelector(".element__number-like");return u.src=t,a.querySelector(".element__text").textContent=o,u.alt="Иллюстрация места ".concat(o),i.addEventListener("click",(function(t){var n;t.target.classList.contains("element__like_active")?(t.target.classList.remove("element__like_active"),function(t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:e.headers,"Content-Type":"application/json"}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(r).then((function(e){l.textContent=e.likes.length})).catch((function(e){console.log(e.message)}))):(t.target.classList.add("element__like_active"),(n=r,fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{method:"PUT",headers:e.headers,"Content-Type":"application/json"}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){l.textContent=e.likes.length})).catch((function(e){console.log(e.message)})))})),u.addEventListener("click",(function(){n(c);var e=document.querySelector(".image__container");e.querySelector(".image__src").src=t,e.querySelector(".image__place").textContent=o})),a}function u(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.removeAttribute("disabled")):(t.classList.add(n.inactiveButtonClass),t.setAttribute("disabled",!0))}var i=document.querySelector(".popup__container-place"),l=i.querySelector(".popup__item_type_link"),s=i.querySelector(".popup__item_type_location"),d=document.querySelector(".elements"),p=document.querySelector(".place"),_=document.querySelector(".profile"),m=_.querySelector(".profile__title"),f=_.querySelector(".profile__subtitle"),v=document.querySelector(".edit-profile__container"),y=v.querySelector(".popup__item_type_name"),h=v.querySelector(".popup__item_type_job"),b=document.querySelector(".edit-profile"),S=document.querySelector(".avatar__container"),q=document.querySelector(".popup__item_type_avatar"),L=document.querySelector(".avatar"),C=document.querySelector(".edit-profile__button"),E=document.querySelector(".place__button"),k=document.querySelector(".avatar__button");function g(e,t){t&&(e.textContent="Сохранение...")}var j,x=_.querySelector(".profile__edit-button"),A=_.querySelector(".profile__add-button"),T=document.querySelector(".profile__modify-button"),U=document.querySelector(".edit-profile__button"),P=document.querySelector(".place__button"),D=document.querySelector(".avatar__button"),B=document.querySelectorAll(".popup"),N=document.querySelector(".profile__avatar");fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){m.textContent=e.name,f.textContent=e.about,N.src=e.avatar})).catch((function(e){console.log(e)})),t().then((function(t){t.forEach((function(t){var n=a(t.link,t.name,t._id);if("e5fcdabd0c334fb91ee2be3d"==t.owner._id){d.append(n);var o=document.querySelector(".element"),r=document.createElement("button"),c=document.querySelectorAll(".element");r.classList.add("element__delete"),c.forEach((function(e){e.prepend(r)})),r.addEventListener("click",(function(){var n;o.remove(),(n=t._id,fetch("".concat(e.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){console.log(e)})).catch((function(e){console.log(e)}))}))}else d.append(n)}))})).catch((function(e){console.log(e)})),x.addEventListener("click",(function(){n(b),y.value=m.textContent,h.value=f.textContent,U.textContent="Сохранить",U.classList.remove("popup__button_inactive"),U.removeAttribute("disabled")})),A.addEventListener("click",(function(){n(p),i.reset(),P.textContent="Создать",P.classList.add("popup__button_inactive"),P.setAttribute("disabled",!0)})),T.addEventListener("click",(function(){n(L),S.reset(),D.textContent="Сохранить",D.classList.add("popup__button_inactive"),D.setAttribute("disabled",!0)})),B.forEach((function(e){e.addEventListener("click",(function(t){t.target.classList.contains("popup_opened")&&o(e),t.target.classList.contains("popup__close")&&o(e)}))})),v.addEventListener("submit",(function(t){var n;t.preventDefault(),g(C,!0),m.textContent="".concat(y.value),f.textContent="".concat(h.value),n={name:y.value,about:h.value},fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,"Content-Type":"application/json",body:JSON.stringify({name:n.name,about:n.about,avatar:n.avatar})}),o(b)})),i.addEventListener("submit",(function(n){n.preventDefault(),g(E,!0);var r=a(l.value,s.value);d.prepend(r),function(t){fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,"Content-Type":"application/json",body:JSON.stringify({name:t.name,link:t.link,_id:t._id})})}({name:s.value,link:l.value}),t().then((function(){var e=document.createElement("button"),t=document.querySelector(".element");e.classList.add("element__delete"),t.prepend(e)})),o(p)})),S.addEventListener("submit",(function(t){var n;t.preventDefault(),g(k,!0),n={avatar:q.value},fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,"Content-Type":"application/json",body:JSON.stringify({avatar:n.avatar})}),o(L)})),j={formSelector:".popup__container",inputSelector:".popup__item",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},Array.from(document.querySelectorAll(j.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,r,t),u(n,o,t)})),u(n,o,t)}))}(e,j)}))})();